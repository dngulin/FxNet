namespace FxNet.Math {
  internal static unsafe class FxLut {
    public const long PiRaw = 823549;
    public const long DegToRadRaw = 4575;
    public const long RadToDegRaw = 15019744;

    private const int SqrtShift = 10;
    private const long SqrtStepRaw = 1 << SqrtShift;
    private const long SqrtStepMask = (long) (ulong.MaxValue >> (64 - SqrtShift));

    public static FxNum Sqrt(in long raw) {
      fixed(int* lut = LutSqrt) {
        var index = raw >> SqrtShift;
        var bot = FxNum.FromRaw(lut[index]);
        var top = FxNum.FromRaw(lut[index + 1]);
        var factor = FxNum.FromRaw(raw & SqrtStepMask) / FxNum.FromRaw(SqrtStepRaw);
        return bot + factor * (top - bot);
      }
    }

    private static readonly int[] LutSqrt =  {
      0, 16384, 23170, 28377, 32768, 36635, 40132, 43347,
      46340, 49152, 51810, 54339, 56755, 59073, 61303, 63454,
      65536, 67552, 69511, 71416, 73271, 75080, 76847, 78574,
      80264, 81920, 83542, 85133, 86695, 88230, 89738, 91222,
      92681, 94118, 95534, 96929, 98304, 99659, 100997, 102318,
      103621, 104908, 106180, 107437, 108679, 109907, 111121, 112323,
      113511, 114688, 115852, 117005, 118146, 119277, 120397, 121506,
      122606, 123696, 124776, 125847, 126909, 127963, 129007, 130043,
      131072, 132092, 133104, 134108, 135105, 136095, 137078, 138054,
      139022, 139984, 140940, 141889, 142832, 143769, 144699, 145624,
      146542, 147456, 148363, 149265, 150161, 151053, 151938, 152819,
      153695, 154566, 155432, 156293, 157149, 158001, 158848, 159691,
      160529, 161363, 162193, 163018, 163840, 164657, 165470, 166279,
      167084, 167886, 168683, 169477, 170267, 171053, 171836, 172616,
      173391, 174164, 174933, 175698, 176461, 177220, 177975, 178728,
      179477, 180224, 180967, 181707, 182444, 183178, 183909, 184638,
      185363, 186086, 186806, 187523, 188237, 188949, 189658, 190364,
      191068, 191769, 192468, 193164, 193858, 194549, 195237, 195924,
      196608, 197289, 197968, 198645, 199319, 199992, 200662, 201329,
      201995, 202658, 203320, 203979, 204636, 205290, 205943, 206594,
      207243, 207889, 208534, 209176, 209817, 210456, 211093, 211727,
      212360, 212992, 213621, 214248, 214874, 215497, 216119, 216739,
      217358, 217974, 218589, 219202, 219814, 220424, 221032, 221638,
      222243, 222846, 223447, 224047, 224646, 225242, 225837, 226431,
      227023, 227613, 228202, 228790, 229376, 229960, 230543, 231124,
      231704, 232283, 232860, 233436, 234010, 234583, 235154, 235724,
      236293, 236860, 237426, 237991, 238554, 239116, 239677, 240236,
      240794, 241351, 241906, 242461, 243013, 243565, 244116, 244665,
      245213, 245760, 246305, 246849, 247392, 247934, 248475, 249015,
      249553, 250090, 250627, 251161, 251695, 252228, 252760, 253290,
      253819, 254348, 254875, 255401, 255926, 256450, 256972, 257494,
      258015, 258535, 259053, 259571, 260087, 260603, 261117, 261631,
      262144, 262655, 263166, 263675, 264184, 264691, 265198, 265703,
      266208, 266712, 267214, 267716, 268217, 268717, 269216, 269714,
      270211, 270708, 271203, 271697, 272191, 272684, 273175, 273666,
      274156, 274645, 275134, 275621, 276108, 276593, 277078, 277562,
      278045, 278528, 279009, 279490, 279969, 280448, 280927, 281404,
      281880, 282356, 282831, 283305, 283779, 284251, 284723, 285194,
      285664, 286134, 286602, 287070, 287538, 288004, 288470, 288934,
      289399, 289862, 290325, 290787, 291248, 291708, 292168, 292627,
      293085, 293543, 294000, 294456, 294912, 295366, 295820, 296274,
      296726, 297178, 297630, 298080, 298530, 298979, 299428, 299876,
      300323, 300770, 301216, 301661, 302106, 302549, 302993, 303435,
      303877, 304319, 304760, 305200, 305639, 306078, 306516, 306954,
      307391, 307827, 308263, 308698, 309132, 309566, 309999, 310432,
      310864, 311296, 311726, 312157, 312586, 313015, 313444, 313872,
      314299, 314726, 315152, 315578, 316003, 316427, 316851, 317274,
      317697, 318119, 318541, 318962, 319382, 319802, 320222, 320641,
      321059, 321477, 321894, 322311, 322727, 323142, 323558, 323972,
      324386, 324800, 325213, 325625, 326037, 326448, 326859, 327270,
      327680, 328089, 328498, 328906, 329314, 329721, 330128, 330534,
      330940, 331345, 331750, 332155, 332558, 332962, 333365, 333767,
      334169, 334570, 334971, 335372, 335772, 336171, 336570, 336969,
      337367, 337764, 338161, 338558, 338954, 339350, 339745, 340140,
      340535, 340928, 341322, 341715, 342107, 342500, 342891, 343282,
      343673, 344064, 344453, 344843, 345232, 345620, 346008, 346396,
      346783, 347170, 347557, 347943, 348328, 348713, 349098, 349482,
      349866, 350249, 350632, 351015, 351397, 351779, 352160, 352541,
      352922, 353302, 353681, 354061, 354440, 354818, 355196, 355574,
      355951, 356328, 356704, 357081, 357456, 357831, 358206, 358581,
      358955, 359329, 359702, 360075, 360448, 360820, 361191, 361563,
      361934, 362305, 362675, 363045, 363414, 363783, 364152, 364520,
      364889, 365256, 365623, 365990, 366357, 366723, 367089, 367454,
      367819, 368184, 368548, 368912, 369276, 369639, 370002, 370365,
      370727, 371089, 371450, 371812, 372172, 372533, 372893, 373253,
      373612, 373971, 374330, 374688, 375046, 375404, 375761, 376118,
      376475, 376832, 377188, 377543, 377899, 378254, 378608, 378963,
      379317, 379670, 380024, 380377, 380729, 381082, 381434, 381785,
      382137, 382488, 382839, 383189, 383539, 383889, 384238, 384588,
      384936, 385285, 385633, 385981, 386329, 386676, 387023, 387369,
      387716, 388062, 388407, 388753, 389098, 389443, 389787, 390131,
      390475, 390819, 391162, 391505, 391848, 392190, 392532, 392874,
      393216, 393557, 393898, 394238, 394578, 394918, 395258, 395598,
      395937, 396276, 396614, 396952, 397290, 397628, 397965, 398303,
      398639, 398976, 399312, 399648, 399984, 400319, 400654, 400989,
      401324, 401658, 401992, 402326, 402659, 402993, 403326, 403658,
      403991, 404323, 404654, 404986, 405317, 405648, 405979, 406309,
      406640, 406970, 407299, 407629, 407958, 408287, 408615, 408944,
      409272, 409600, 409927, 410254, 410581, 410908, 411235, 411561,
      411887, 412213, 412538, 412863, 413188, 413513, 413837, 414162,
      414486, 414809, 415133, 415456, 415779, 416101, 416424, 416746,
      417068, 417390, 417711, 418032, 418353, 418674, 418994, 419315,
      419635, 419954, 420274, 420593, 420912, 421231, 421549, 421868,
      422186, 422503, 422821, 423138, 423455, 423772, 424089, 424405,
      424721, 425037, 425353, 425668, 425984, 426298, 426613, 426928,
      427242, 427556, 427870, 428183, 428497, 428810, 429123, 429435,
      429748, 430060, 430372, 430684, 430995, 431307, 431618, 431928,
      432239, 432550, 432860, 433170, 433479, 433789, 434098, 434407,
      434716, 435025, 435333, 435641, 435949, 436257, 436565, 436872,
      437179, 437486, 437793, 438099, 438405, 438712, 439017, 439323,
      439628, 439934, 440239, 440543, 440848, 441152, 441456, 441760,
      442064, 442368, 442671, 442974, 443277, 443579, 443882, 444184,
      444486, 444788, 445090, 445391, 445692, 445994, 446294, 446595,
      446895, 447196, 447496, 447796, 448095, 448395, 448694, 448993,
      449292, 449590, 449889, 450187, 450485, 450783, 451081, 451378,
      451675, 451972, 452269, 452566, 452862, 453159, 453455, 453751,
      454046, 454342, 454637, 454932, 455227, 455522, 455816, 456111,
      456405, 456699, 456993, 457286, 457580, 457873, 458166, 458459,
      458752, 459044, 459336, 459628, 459920, 460212, 460504, 460795,
      461086, 461377, 461668, 461959, 462249, 462539, 462829, 463119,
      463409, 463699, 463988, 464277, 464566, 464855, 465144, 465432,
      465720, 466008, 466296, 466584, 466872, 467159, 467446, 467733,
      468020, 468307, 468593, 468880, 469166, 469452, 469738, 470023,
      470309, 470594, 470879, 471164, 471449, 471734, 472018, 472302,
      472586, 472870, 473154, 473438, 473721, 474004, 474287, 474570,
      474853, 475136, 475418, 475700, 475982, 476264, 476546, 476827,
      477109, 477390, 477671, 477952, 478233, 478513, 478794, 479074,
      479354, 479634, 479914, 480193, 480473, 480752, 481031, 481310,
      481589, 481867, 482146, 482424, 482702, 482980, 483258, 483536,
      483813, 484091, 484368, 484645, 484922, 485198, 485475, 485751,
      486027, 486304, 486579, 486855, 487131, 487406, 487682, 487957,
      488232, 488507, 488781, 489056, 489330, 489604, 489878, 490152,
      490426, 490700, 490973, 491246, 491520, 491792, 492065, 492338,
      492611, 492883, 493155, 493427, 493699, 493971, 494243, 494514,
      494785, 495057, 495328, 495599, 495869, 496140, 496410, 496681,
      496951, 497221, 497491, 497760, 498030, 498299, 498569, 498838,
      499107, 499376, 499644, 499913, 500181, 500450, 500718, 500986,
      501254, 501521, 501789, 502056, 502323, 502591, 502858, 503124,
      503391, 503658, 503924, 504190, 504456, 504722, 504988, 505254,
      505520, 505785, 506050, 506315, 506580, 506845, 507110, 507375,
      507639, 507904, 508168, 508432, 508696, 508959, 509223, 509487,
      509750, 510013, 510276, 510539, 510802, 511065, 511327, 511590,
      511852, 512114, 512376, 512638, 512900, 513161, 513423, 513684,
      513945, 514207, 514468, 514728, 514989, 515250, 515510, 515770,
      516030, 516291, 516550, 516810, 517070, 517329, 517589, 517848,
      518107, 518366, 518625, 518884, 519142, 519401, 519659, 519917,
      520175, 520433, 520691, 520949, 521206, 521464, 521721, 521978,
      522235, 522492, 522749, 523006, 523262, 523519, 523775, 524031,
      524288, 524288,
    };

    private const int CosShift = 8;
    private const long CosStepRaw = 1 << CosShift;
    private const long CosStepMask = (long) (ulong.MaxValue >> (64 - CosShift));

    public static FxNum Cos(in long raw) {
      fixed(int* lut = LutCos) {
        var index = raw >> CosShift;
        var bot = FxNum.FromRaw(lut[index]);
        var top = FxNum.FromRaw(lut[index + 1]);
        var factor = FxNum.FromRaw(raw & CosStepMask) / FxNum.FromRaw(CosStepRaw);
        return bot + factor * (top - bot);
      }
    }

    private static readonly int[] LutCos =  {
      262144, 262143, 262143, 262142, 262142, 262140, 262139, 262137,
      262136, 262133, 262131, 262128, 262126, 262122, 262119, 262115,
      262112, 262107, 262103, 262098, 262094, 262088, 262083, 262077,
      262072, 262065, 262059, 262052, 262046, 262038, 262031, 262023,
      262016, 262007, 261999, 261990, 261982, 261972, 261963, 261953,
      261944, 261933, 261923, 261912, 261902, 261890, 261879, 261867,
      261856, 261843, 261831, 261818, 261806, 261792, 261779, 261765,
      261752, 261737, 261723, 261708, 261694, 261679, 261663, 261648,
      261632, 261616, 261599, 261583, 261566, 261549, 261531, 261514,
      261496, 261478, 261459, 261441, 261422, 261403, 261383, 261364,
      261344, 261324, 261303, 261283, 261262, 261241, 261220, 261198,
      261176, 261154, 261132, 261109, 261086, 261063, 261040, 261016,
      260992, 260968, 260944, 260919, 260894, 260869, 260844, 260818,
      260793, 260767, 260740, 260714, 260687, 260660, 260632, 260605,
      260577, 260549, 260521, 260492, 260463, 260434, 260405, 260375,
      260346, 260316, 260285, 260255, 260224, 260193, 260162, 260130,
      260098, 260066, 260034, 260001, 259969, 259935, 259902, 259869,
      259835, 259801, 259767, 259732, 259697, 259662, 259627, 259592,
      259556, 259520, 259484, 259447, 259410, 259373, 259336, 259299,
      259261, 259223, 259185, 259146, 259107, 259068, 259029, 258990,
      258950, 258910, 258870, 258829, 258789, 258748, 258707, 258665,
      258623, 258581, 258539, 258497, 258454, 258411, 258368, 258325,
      258281, 258237, 258193, 258149, 258104, 258059, 258014, 257969,
      257923, 257877, 257831, 257785, 257738, 257691, 257644, 257597,
      257549, 257501, 257453, 257405, 257356, 257307, 257258, 257209,
      257159, 257110, 257060, 257009, 256959, 256908, 256857, 256806,
      256754, 256702, 256650, 256598, 256546, 256493, 256440, 256387,
      256333, 256279, 256225, 256171, 256117, 256062, 256007, 255952,
      255896, 255841, 255785, 255729, 255672, 255616, 255559, 255502,
      255444, 255387, 255329, 255271, 255212, 255154, 255095, 255036,
      254976, 254917, 254857, 254797, 254737, 254676, 254615, 254554,
      254493, 254431, 254370, 254308, 254245, 254183, 254120, 254057,
      253994, 253931, 253867, 253803, 253739, 253674, 253610, 253545,
      253480, 253414, 253349, 253283, 253217, 253150, 253084, 253017,
      252950, 252882, 252815, 252747, 252679, 252611, 252542, 252473,
      252404, 252335, 252266, 252196, 252126, 252056, 251985, 251915,
      251844, 251772, 251701, 251629, 251558, 251485, 251413, 251340,
      251268, 251194, 251121, 251048, 250974, 250900, 250825, 250751,
      250676, 250601, 250526, 250450, 250375, 250299, 250222, 250146,
      250069, 249992, 249915, 249838, 249760, 249682, 249604, 249526,
      249447, 249369, 249289, 249210, 249131, 249051, 248971, 248891,
      248810, 248729, 248648, 248567, 248486, 248404, 248322, 248240,
      248158, 248075, 247992, 247909, 247826, 247742, 247658, 247574,
      247490, 247406, 247321, 247236, 247151, 247065, 246979, 246894,
      246807, 246721, 246634, 246548, 246460, 246373, 246286, 246198,
      246110, 246021, 245933, 245844, 245755, 245666, 245577, 245487,
      245397, 245307, 245216, 245126, 245035, 244944, 244853, 244761,
      244669, 244577, 244485, 244392, 244300, 244207, 244114, 244020,
      243926, 243833, 243738, 243644, 243550, 243455, 243360, 243264,
      243169, 243073, 242977, 242881, 242785, 242688, 242591, 242494,
      242397, 242299, 242201, 242103, 242005, 241906, 241808, 241709,
      241609, 241510, 241410, 241310, 241210, 241110, 241009, 240908,
      240807, 240706, 240605, 240503, 240401, 240299, 240196, 240094,
      239991, 239888, 239784, 239681, 239577, 239473, 239369, 239264,
      239159, 239055, 238949, 238844, 238738, 238632, 238526, 238420,
      238314, 238207, 238100, 237993, 237885, 237777, 237670, 237561,
      237453, 237345, 237236, 237127, 237017, 236908, 236798, 236688,
      236578, 236468, 236357, 236246, 236135, 236024, 235913, 235801,
      235689, 235577, 235464, 235352, 235239, 235126, 235012, 234899,
      234785, 234671, 234557, 234442, 234328, 234213, 234098, 233983,
      233867, 233751, 233635, 233519, 233403, 233286, 233169, 233052,
      232935, 232817, 232699, 232581, 232463, 232345, 232226, 232107,
      231988, 231869, 231749, 231629, 231509, 231389, 231269, 231148,
      231027, 230906, 230785, 230663, 230542, 230420, 230298, 230175,
      230053, 229930, 229807, 229683, 229560, 229436, 229312, 229188,
      229064, 228939, 228814, 228689, 228564, 228438, 228313, 228187,
      228061, 227934, 227808, 227681, 227554, 227427, 227299, 227172,
      227044, 226916, 226788, 226659, 226530, 226401, 226272, 226143,
      226013, 225884, 225754, 225623, 225493, 225362, 225231, 225100,
      224969, 224837, 224706, 224574, 224442, 224309, 224177, 224044,
      223911, 223778, 223644, 223510, 223377, 223242, 223108, 222974,
      222839, 222704, 222569, 222434, 222298, 222162, 222026, 221890,
      221754, 221617, 221480, 221343, 221206, 221068, 220931, 220793,
      220655, 220516, 220378, 220239, 220100, 219961, 219822, 219682,
      219542, 219402, 219262, 219122, 218981, 218840, 218699, 218558,
      218416, 218275, 218133, 217991, 217848, 217706, 217563, 217420,
      217277, 217134, 216990, 216847, 216703, 216558, 216414, 216270,
      216125, 215980, 215835, 215689, 215544, 215398, 215252, 215106,
      214959, 214813, 214666, 214519, 214371, 214224, 214076, 213928,
      213780, 213632, 213484, 213335, 213186, 213037, 212888, 212738,
      212589, 212439, 212289, 212138, 211988, 211837, 211686, 211535,
      211384, 211232, 211081, 210929, 210777, 210624, 210472, 210319,
      210166, 210013, 209860, 209706, 209553, 209399, 209245, 209090,
      208936, 208781, 208626, 208471, 208316, 208160, 208004, 207849,
      207692, 207536, 207380, 207223, 207066, 206909, 206752, 206594,
      206437, 206279, 206121, 205962, 205804, 205645, 205486, 205327,
      205168, 205009, 204849, 204689, 204529, 204369, 204208, 204048,
      203887, 203726, 203565, 203403, 203242, 203080, 202918, 202756,
      202594, 202431, 202268, 202105, 201942, 201779, 201615, 201452,
      201288, 201124, 200959, 200795, 200630, 200465, 200300, 200135,
      199970, 199804, 199638, 199472, 199306, 199140, 198973, 198806,
      198639, 198472, 198305, 198137, 197970, 197802, 197634, 197465,
      197297, 197128, 196959, 196790, 196621, 196452, 196282, 196112,
      195942, 195772, 195602, 195431, 195261, 195090, 194919, 194747,
      194576, 194404, 194232, 194060, 193888, 193716, 193543, 193370,
      193197, 193024, 192851, 192678, 192504, 192330, 192156, 191982,
      191807, 191633, 191458, 191283, 191108, 190933, 190757, 190581,
      190406, 190229, 190053, 189877, 189700, 189523, 189347, 189169,
      188992, 188815, 188637, 188459, 188281, 188103, 187924, 187746,
      187567, 187388, 187209, 187030, 186850, 186671, 186491, 186311,
      186131, 185950, 185770, 185589, 185408, 185227, 185046, 184864,
      184683, 184501, 184319, 184137, 183955, 183772, 183590, 183407,
      183224, 183041, 182857, 182674, 182490, 182306, 182122, 181938,
      181753, 181569, 181384, 181199, 181014, 180829, 180644, 180458,
      180272, 180086, 179900, 179714, 179527, 179341, 179154, 178967,
      178780, 178592, 178405, 178217, 178030, 177842, 177653, 177465,
      177277, 177088, 176899, 176710, 176521, 176331, 176142, 175952,
      175762, 175572, 175382, 175192, 175001, 174811, 174620, 174429,
      174238, 174046, 173855, 173663, 173471, 173279, 173087, 172895,
      172702, 172510, 172317, 172124, 171931, 171737, 171544, 171350,
      171156, 170962, 170768, 170574, 170379, 170185, 169990, 169795,
      169600, 169404, 169209, 169013, 168818, 168622, 168426, 168229,
      168033, 167836, 167640, 167443, 167246, 167049, 166851, 166654,
      166456, 166258, 166060, 165862, 165664, 165465, 165266, 165068,
      164869, 164670, 164470, 164271, 164071, 163872, 163672, 163472,
      163271, 163071, 162871, 162670, 162469, 162268, 162067, 161866,
      161664, 161463, 161261, 161059, 160857, 160655, 160452, 160250,
      160047, 159844, 159641, 159438, 159235, 159031, 158828, 158624,
      158420, 158216, 158012, 157808, 157603, 157399, 157194, 156989,
      156784, 156579, 156373, 156168, 155962, 155756, 155550, 155344,
      155138, 154931, 154725, 154518, 154311, 154104, 153897, 153690,
      153482, 153274, 153067, 152859, 152651, 152443, 152234, 152026,
      151817, 151608, 151399, 151190, 150981, 150772, 150562, 150353,
      150143, 149933, 149723, 149513, 149302, 149092, 148881, 148670,
      148460, 148249, 148037, 147826, 147614, 147403, 147191, 146979,
      146767, 146555, 146343, 146130, 145918, 145705, 145492, 145279,
      145066, 144852, 144639, 144425, 144212, 143998, 143784, 143570,
      143356, 143141, 142927, 142712, 142497, 142282, 142067, 141852,
      141637, 141421, 141205, 140990, 140774, 140558, 140342, 140125,
      139909, 139692, 139476, 139259, 139042, 138825, 138608, 138390,
      138173, 137955, 137737, 137519, 137301, 137083, 136865, 136647,
      136428, 136209, 135991, 135772, 135553, 135333, 135114, 134895,
      134675, 134455, 134236, 134016, 133796, 133575, 133355, 133135,
      132914, 132693, 132472, 132251, 132030, 131809, 131588, 131366,
      131145, 130923, 130701, 130479, 130257, 130035, 129813, 129590,
      129367, 129145, 128922, 128699, 128476, 128253, 128029, 127806,
      127582, 127359, 127135, 126911, 126687, 126463, 126238, 126014,
      125789, 125565, 125340, 125115, 124890, 124665, 124440, 124214,
      123989, 123763, 123537, 123311, 123086, 122859, 122633, 122407,
      122180, 121954, 121727, 121500, 121274, 121047, 120819, 120592,
      120365, 120137, 119910, 119682, 119454, 119226, 118998, 118770,
      118542, 118313, 118085, 117856, 117628, 117399, 117170, 116941,
      116712, 116482, 116253, 116023, 115794, 115564, 115334, 115104,
      114874, 114644, 114414, 114183, 113953, 113722, 113492, 113261,
      113030, 112799, 112568, 112336, 112105, 111874, 111642, 111410,
      111179, 110947, 110715, 110483, 110250, 110018, 109786, 109553,
      109321, 109088, 108855, 108622, 108389, 108156, 107923, 107689,
      107456, 107222, 106989, 106755, 106521, 106287, 106053, 105819,
      105584, 105350, 105116, 104881, 104646, 104412, 104177, 103942,
      103707, 103472, 103236, 103001, 102765, 102530, 102294, 102059,
      101823, 101587, 101351, 101115, 100878, 100642, 100406, 100169,
      99932, 99696, 99459, 99222, 98985, 98748, 98511, 98273,
      98036, 97799, 97561, 97323, 97086, 96848, 96610, 96372,
      96134, 95895, 95657, 95419, 95180, 94942, 94703, 94464,
      94225, 93986, 93747, 93508, 93269, 93030, 92790, 92551,
      92311, 92072, 91832, 91592, 91352, 91112, 90872, 90632,
      90392, 90151, 89911, 89671, 89430, 89189, 88948, 88708,
      88467, 88226, 87985, 87743, 87502, 87261, 87019, 86778,
      86536, 86294, 86053, 85811, 85569, 85327, 85085, 84843,
      84600, 84358, 84116, 83873, 83630, 83388, 83145, 82902,
      82659, 82416, 82173, 81930, 81687, 81444, 81200, 80957,
      80713, 80470, 80226, 79982, 79738, 79495, 79251, 79007,
      78762, 78518, 78274, 78030, 77785, 77541, 77296, 77051,
      76807, 76562, 76317, 76072, 75827, 75582, 75337, 75091,
      74846, 74601, 74355, 74110, 73864, 73619, 73373, 73127,
      72881, 72635, 72389, 72143, 71897, 71651, 71404, 71158,
      70912, 70665, 70419, 70172, 69925, 69679, 69432, 69185,
      68938, 68691, 68444, 68197, 67949, 67702, 67455, 67207,
      66960, 66712, 66465, 66217, 65969, 65722, 65474, 65226,
      64978, 64730, 64482, 64234, 63985, 63737, 63489, 63240,
      62992, 62743, 62495, 62246, 61997, 61749, 61500, 61251,
      61002, 60753, 60504, 60255, 60006, 59756, 59507, 59258,
      59008, 58759, 58509, 58260, 58010, 57760, 57511, 57261,
      57011, 56761, 56511, 56261, 56011, 55761, 55511, 55261,
      55010, 54760, 54510, 54259, 54009, 53758, 53508, 53257,
      53006, 52756, 52505, 52254, 52003, 51752, 51501, 51250,
      50999, 50748, 50497, 50245, 49994, 49743, 49491, 49240,
      48989, 48737, 48486, 48234, 47982, 47731, 47479, 47227,
      46975, 46723, 46471, 46219, 45967, 45715, 45463, 45211,
      44959, 44707, 44454, 44202, 43950, 43697, 43445, 43192,
      42940, 42687, 42435, 42182, 41929, 41677, 41424, 41171,
      40918, 40665, 40413, 40160, 39907, 39654, 39400, 39147,
      38894, 38641, 38388, 38135, 37881, 37628, 37375, 37121,
      36868, 36614, 36361, 36107, 35854, 35600, 35346, 35093,
      34839, 34585, 34331, 34078, 33824, 33570, 33316, 33062,
      32808, 32554, 32300, 32046, 31792, 31538, 31284, 31029,
      30775, 30521, 30267, 30012, 29758, 29504, 29249, 28995,
      28740, 28486, 28231, 27977, 27722, 27468, 27213, 26959,
      26704, 26449, 26195, 25940, 25685, 25430, 25175, 24921,
      24666, 24411, 24156, 23901, 23646, 23391, 23136, 22881,
      22626, 22371, 22116, 21861, 21606, 21351, 21095, 20840,
      20585, 20330, 20075, 19819, 19564, 19309, 19054, 18798,
      18543, 18287, 18032, 17777, 17521, 17266, 17010, 16755,
      16499, 16244, 15988, 15733, 15477, 15222, 14966, 14711,
      14455, 14199, 13944, 13688, 13432, 13177, 12921, 12665,
      12410, 12154, 11898, 11643, 11387, 11131, 10875, 10619,
      10364, 10108, 9852, 9596, 9340, 9085, 8829, 8573,
      8317, 8061, 7805, 7549, 7293, 7037, 6782, 6526,
      6270, 6014, 5758, 5502, 5246, 4990, 4734, 4478,
      4222, 3966, 3710, 3454, 3198, 2942, 2686, 2430,
      2174, 1918, 1662, 1406, 1150, 894, 638, 382,
      126, 126,
    };

    private const int AsinShift = 8;
    private const long AsinStepRaw = 1 << AsinShift;
    private const long AsinStepMask = (long) (ulong.MaxValue >> (64 - AsinShift));

    public static FxNum Asin(in long raw) {
      fixed(int* lut = LutAsin) {
        var index = raw >> AsinShift;
        var bot = FxNum.FromRaw(lut[index]);
        var top = FxNum.FromRaw(lut[index + 1]);
        var factor = FxNum.FromRaw(raw & AsinStepMask) / FxNum.FromRaw(AsinStepRaw);
        return bot + factor * (top - bot);
      }
    }

    private static readonly int[] LutAsin =  {
      0, 256, 512, 768, 1024, 1280, 1536, 1792,
      2048, 2304, 2560, 2816, 3072, 3328, 3584, 3840,
      4096, 4352, 4608, 4864, 5120, 5376, 5632, 5888,
      6144, 6400, 6656, 6912, 7168, 7424, 7681, 7937,
      8193, 8449, 8705, 8961, 9217, 9474, 9730, 9986,
      10242, 10498, 10755, 11011, 11267, 11523, 11779, 12036,
      12292, 12548, 12805, 13061, 13317, 13574, 13830, 14086,
      14343, 14599, 14855, 15112, 15368, 15625, 15881, 16138,
      16394, 16651, 16907, 17164, 17420, 17677, 17933, 18190,
      18447, 18703, 18960, 19217, 19473, 19730, 19987, 20244,
      20500, 20757, 21014, 21271, 21528, 21785, 22041, 22298,
      22555, 22812, 23069, 23326, 23583, 23840, 24097, 24355,
      24612, 24869, 25126, 25383, 25640, 25898, 26155, 26412,
      26669, 26927, 27184, 27442, 27699, 27956, 28214, 28471,
      28729, 28987, 29244, 29502, 29759, 30017, 30275, 30532,
      30790, 31048, 31306, 31564, 31822, 32080, 32337, 32595,
      32853, 33111, 33370, 33628, 33886, 34144, 34402, 34660,
      34919, 35177, 35435, 35694, 35952, 36211, 36469, 36728,
      36986, 37245, 37503, 37762, 38021, 38279, 38538, 38797,
      39056, 39315, 39574, 39833, 40092, 40351, 40610, 40869,
      41128, 41387, 41646, 41906, 42165, 42424, 42684, 42943,
      43203, 43462, 43722, 43982, 44241, 44501, 44761, 45020,
      45280, 45540, 45800, 46060, 46320, 46580, 46840, 47101,
      47361, 47621, 47881, 48142, 48402, 48663, 48923, 49184,
      49444, 49705, 49965, 50226, 50487, 50748, 51009, 51270,
      51531, 51792, 52053, 52314, 52575, 52837, 53098, 53359,
      53621, 53882, 54144, 54405, 54667, 54929, 55190, 55452,
      55714, 55976, 56238, 56500, 56762, 57024, 57286, 57549,
      57811, 58073, 58336, 58598, 58861, 59123, 59386, 59649,
      59912, 60175, 60438, 60700, 60964, 61227, 61490, 61753,
      62016, 62280, 62543, 62807, 63070, 63334, 63598, 63861,
      64125, 64389, 64653, 64917, 65181, 65445, 65709, 65974,
      66238, 66503, 66767, 67032, 67296, 67561, 67826, 68091,
      68356, 68621, 68886, 69151, 69416, 69681, 69947, 70212,
      70477, 70743, 71009, 71274, 71540, 71806, 72072, 72338,
      72604, 72870, 73137, 73403, 73669, 73936, 74202, 74469,
      74736, 75003, 75270, 75536, 75804, 76071, 76338, 76605,
      76873, 77140, 77408, 77675, 77943, 78211, 78479, 78746,
      79015, 79283, 79551, 79819, 80088, 80356, 80625, 80893,
      81162, 81431, 81700, 81969, 82238, 82507, 82776, 83046,
      83315, 83585, 83854, 84124, 84394, 84664, 84934, 85204,
      85474, 85744, 86015, 86285, 86556, 86826, 87097, 87368,
      87639, 87910, 88181, 88452, 88724, 88995, 89267, 89538,
      89810, 90082, 90354, 90626, 90898, 91170, 91443, 91715,
      91988, 92260, 92533, 92806, 93079, 93352, 93625, 93899,
      94172, 94446, 94719, 94993, 95267, 95541, 95815, 96089,
      96363, 96638, 96912, 97187, 97461, 97736, 98011, 98286,
      98561, 98837, 99112, 99388, 99663, 99939, 100215, 100491,
      100767, 101043, 101319, 101596, 101872, 102149, 102426, 102703,
      102980, 103257, 103534, 103812, 104089, 104367, 104645, 104923,
      105201, 105479, 105757, 106035, 106314, 106593, 106871, 107150,
      107429, 107709, 107988, 108267, 108547, 108827, 109106, 109386,
      109666, 109947, 110227, 110508, 110788, 111069, 111350, 111631,
      111912, 112193, 112475, 112756, 113038, 113320, 113602, 113884,
      114166, 114449, 114731, 115014, 115297, 115580, 115863, 116146,
      116430, 116713, 116997, 117281, 117565, 117849, 118134, 118418,
      118703, 118987, 119272, 119557, 119843, 120128, 120414, 120699,
      120985, 121271, 121557, 121843, 122130, 122417, 122703, 122990,
      123277, 123565, 123852, 124140, 124427, 124715, 125003, 125292,
      125580, 125868, 126157, 126446, 126735, 127024, 127314, 127603,
      127893, 128183, 128473, 128763, 129054, 129344, 129635, 129926,
      130217, 130508, 130800, 131091, 131383, 131675, 131967, 132260,
      132552, 132845, 133138, 133431, 133724, 134018, 134311, 134605,
      134899, 135193, 135488, 135782, 136077, 136372, 136667, 136962,
      137258, 137553, 137849, 138145, 138442, 138738, 139035, 139332,
      139629, 139926, 140224, 140521, 140819, 141117, 141415, 141714,
      142013, 142311, 142611, 142910, 143209, 143509, 143809, 144109,
      144409, 144710, 145011, 145312, 145613, 145914, 146216, 146518,
      146820, 147122, 147425, 147727, 148030, 148333, 148637, 148940,
      149244, 149548, 149853, 150157, 150462, 150767, 151072, 151377,
      151683, 151989, 152295, 152601, 152908, 153215, 153522, 153829,
      154137, 154445, 154753, 155061, 155369, 155678, 155987, 156297,
      156606, 156916, 157226, 157536, 157847, 158157, 158468, 158780,
      159091, 159403, 159715, 160027, 160340, 160653, 160966, 161279,
      161593, 161907, 162221, 162535, 162850, 163165, 163480, 163795,
      164111, 164427, 164744, 165060, 165377, 165694, 166012, 166329,
      166647, 166966, 167284, 167603, 167922, 168242, 168561, 168882,
      169202, 169522, 169843, 170165, 170486, 170808, 171130, 171452,
      171775, 172098, 172422, 172745, 173069, 173393, 173718, 174043,
      174368, 174694, 175019, 175346, 175672, 175999, 176326, 176653,
      176981, 177309, 177638, 177966, 178296, 178625, 178955, 179285,
      179615, 179946, 180277, 180609, 180941, 181273, 181605, 181938,
      182271, 182605, 182939, 183273, 183608, 183943, 184278, 184614,
      184950, 185286, 185623, 185960, 186298, 186636, 186974, 187313,
      187652, 187992, 188331, 188672, 189012, 189353, 189695, 190037,
      190379, 190721, 191064, 191408, 191752, 192096, 192440, 192785,
      193131, 193477, 193823, 194170, 194517, 194864, 195212, 195560,
      195909, 196259, 196608, 196958, 197309, 197660, 198011, 198363,
      198715, 199068, 199421, 199775, 200129, 200484, 200839, 201194,
      201550, 201907, 202263, 202621, 202979, 203337, 203696, 204055,
      204415, 204775, 205136, 205497, 205859, 206221, 206584, 206947,
      207311, 207675, 208040, 208405, 208771, 209137, 209504, 209872,
      210240, 210608, 210977, 211347, 211717, 212087, 212459, 212830,
      213203, 213576, 213949, 214323, 214698, 215073, 215448, 215825,
      216202, 216579, 216957, 217336, 217715, 218095, 218475, 218856,
      219238, 219620, 220003, 220387, 220771, 221156, 221541, 221927,
      222314, 222701, 223089, 223478, 223867, 224257, 224648, 225039,
      225431, 225824, 226217, 226611, 227006, 227402, 227798, 228195,
      228592, 228991, 229390, 229789, 230190, 230591, 230993, 231396,
      231799, 232204, 232609, 233014, 233421, 233828, 234236, 234645,
      235055, 235466, 235877, 236289, 236702, 237116, 237530, 237946,
      238362, 238779, 239197, 239616, 240036, 240457, 240878, 241300,
      241724, 242148, 242573, 242999, 243426, 243854, 244283, 244712,
      245143, 245575, 246008, 246441, 246876, 247311, 247748, 248186,
      248624, 249064, 249505, 249946, 250389, 250833, 251278, 251724,
      252171, 252619, 253068, 253519, 253970, 254423, 254877, 255332,
      255788, 256245, 256703, 257163, 257624, 258086, 258549, 259014,
      259480, 259947, 260415, 260885, 261356, 261828, 262302, 262777,
      263253, 263731, 264210, 264690, 265172, 265655, 266140, 266626,
      267113, 267602, 268093, 268585, 269079, 269574, 270070, 270569,
      271068, 271570, 272073, 272578, 273084, 273592, 274102, 274613,
      275127, 275642, 276158, 276677, 277197, 277719, 278243, 278769,
      279297, 279827, 280359, 280892, 281428, 281966, 282505, 283047,
      283591, 284137, 284685, 285236, 285789, 286343, 286901, 287460,
      288022, 288586, 289152, 289721, 290293, 290867, 291443, 292022,
      292604, 293188, 293775, 294365, 294958, 295553, 296151, 296753,
      297357, 297964, 298574, 299187, 299803, 300423, 301046, 301672,
      302301, 302934, 303571, 304211, 304854, 305502, 306153, 306807,
      307466, 308129, 308795, 309466, 310141, 310821, 311504, 312192,
      312885, 313582, 314284, 314991, 315703, 316420, 317142, 317870,
      318603, 319341, 320085, 320835, 321591, 322354, 323122, 323897,
      324678, 325467, 326262, 327064, 327874, 328692, 329517, 330351,
      331193, 332043, 332902, 333771, 334649, 335536, 336434, 337343,
      338262, 339193, 340135, 341090, 342058, 343038, 344033, 345042,
      346066, 347107, 348163, 349238, 350330, 351443, 352575, 353730,
      354907, 356109, 357337, 358593, 359879, 361197, 362550, 363941,
      365373, 366850, 368377, 369959, 371603, 373316, 375109, 376993,
      378985, 381105, 383383, 385858, 388596, 391703, 395388, 400188,
      411774, 411774,
    };

    private const int AtanShift = 8;
    private const long AtanStepRaw = 1 << AtanShift;
    private const long AtanStepMask = (long) (ulong.MaxValue >> (64 - AtanShift));

    public static FxNum Atan(in long raw) {
      fixed(int* lut = LutAtan) {
        var index = raw >> AtanShift;
        var bot = FxNum.FromRaw(lut[index]);
        var top = FxNum.FromRaw(lut[index + 1]);
        var factor = FxNum.FromRaw(raw & AtanStepMask) / FxNum.FromRaw(AtanStepRaw);
        return bot + factor * (top - bot);
      }
    }

    private static readonly int[] LutAtan =  {
      0, 256, 512, 768, 1024, 1280, 1536, 1792,
      2048, 2304, 2560, 2816, 3072, 3328, 3584, 3840,
      4096, 4352, 4608, 4864, 5120, 5376, 5632, 5888,
      6144, 6400, 6656, 6912, 7168, 7424, 7681, 7937,
      8193, 8449, 8705, 8961, 9217, 9474, 9730, 9986,
      10242, 10498, 10755, 11011, 11267, 11523, 11779, 12036,
      12292, 12548, 12805, 13061, 13317, 13574, 13830, 14086,
      14343, 14599, 14855, 15112, 15368, 15625, 15881, 16138,
      16394, 16651, 16907, 17164, 17420, 17677, 17933, 18190,
      18447, 18703, 18960, 19217, 19473, 19730, 19987, 20244,
      20500, 20757, 21014, 21271, 21528, 21785, 22041, 22298,
      22555, 22812, 23069, 23326, 23583, 23840, 24097, 24355,
      24612, 24869, 25126, 25383, 25640, 25898, 26155, 26412,
      26669, 26927, 27184, 27442, 27699, 27956, 28214, 28471,
      28729, 28987, 29244, 29502, 29759, 30017, 30275, 30532,
      30790, 31048, 31306, 31564, 31822, 32080, 32337, 32595,
      32853, 33111, 33370, 33628, 33886, 34144, 34402, 34660,
      34919, 35177, 35435, 35694, 35952, 36211, 36469, 36728,
      36986, 37245, 37503, 37762, 38021, 38279, 38538, 38797,
      39056, 39315, 39574, 39833, 40092, 40351, 40610, 40869,
      41128, 41387, 41646, 41906, 42165, 42424, 42684, 42943,
      43203, 43462, 43722, 43982, 44241, 44501, 44761, 45020,
      45280, 45540, 45800, 46060, 46320, 46580, 46840, 47101,
      47361, 47621, 47881, 48142, 48402, 48663, 48923, 49184,
      49444, 49705, 49965, 50226, 50487, 50748, 51009, 51270,
      51531, 51792, 52053, 52314, 52575, 52837, 53098, 53359,
      53621, 53882, 54144, 54405, 54667, 54929, 55190, 55452,
      55714, 55976, 56238, 56500, 56762, 57024, 57286, 57549,
      57811, 58073, 58336, 58598, 58861, 59123, 59386, 59649,
      59912, 60175, 60438, 60700, 60964, 61227, 61490, 61753,
      62016, 62280, 62543, 62807, 63070, 63334, 63598, 63861,
      64125, 64389, 64653, 64917, 65181, 65445, 65709, 65974,
      66238, 66503, 66767, 67032, 67296, 67561, 67826, 68091,
      68356, 68621, 68886, 69151, 69416, 69681, 69947, 70212,
      70477, 70743, 71009, 71274, 71540, 71806, 72072, 72338,
      72604, 72870, 73137, 73403, 73669, 73936, 74202, 74469,
      74736, 75003, 75270, 75536, 75804, 76071, 76338, 76605,
      76873, 77140, 77408, 77675, 77943, 78211, 78479, 78746,
      79015, 79283, 79551, 79819, 80088, 80356, 80625, 80893,
      81162, 81431, 81700, 81969, 82238, 82507, 82776, 83046,
      83315, 83585, 83854, 84124, 84394, 84664, 84934, 85204,
      85474, 85744, 86015, 86285, 86556, 86826, 87097, 87368,
      87639, 87910, 88181, 88452, 88724, 88995, 89267, 89538,
      89810, 90082, 90354, 90626, 90898, 91170, 91443, 91715,
      91988, 92260, 92533, 92806, 93079, 93352, 93625, 93899,
      94172, 94446, 94719, 94993, 95267, 95541, 95815, 96089,
      96363, 96638, 96912, 97187, 97461, 97736, 98011, 98286,
      98561, 98837, 99112, 99388, 99663, 99939, 100215, 100491,
      100767, 101043, 101319, 101596, 101872, 102149, 102426, 102703,
      102980, 103257, 103534, 103812, 104089, 104367, 104645, 104923,
      105201, 105479, 105757, 106035, 106314, 106593, 106871, 107150,
      107429, 107709, 107988, 108267, 108547, 108827, 109106, 109386,
      109666, 109947, 110227, 110508, 110788, 111069, 111350, 111631,
      111912, 112193, 112475, 112756, 113038, 113320, 113602, 113884,
      114166, 114449, 114731, 115014, 115297, 115580, 115863, 116146,
      116430, 116713, 116997, 117281, 117565, 117849, 118134, 118418,
      118703, 118987, 119272, 119557, 119843, 120128, 120414, 120699,
      120985, 121271, 121557, 121843, 122130, 122417, 122703, 122990,
      123277, 123565, 123852, 124140, 124427, 124715, 125003, 125292,
      125580, 125868, 126157, 126446, 126735, 127024, 127314, 127603,
      127893, 128183, 128473, 128763, 129054, 129344, 129635, 129926,
      130217, 130508, 130800, 131091, 131383, 131675, 131967, 132260,
      132552, 132845, 133138, 133431, 133724, 134018, 134311, 134605,
      134899, 135193, 135488, 135782, 136077, 136372, 136667, 136962,
      137258, 137553, 137849, 138145, 138442, 138738, 139035, 139332,
      139629, 139926, 140224, 140521, 140819, 141117, 141415, 141714,
      142013, 142311, 142611, 142910, 143209, 143509, 143809, 144109,
      144409, 144710, 145011, 145312, 145613, 145914, 146216, 146518,
      146820, 147122, 147425, 147727, 148030, 148333, 148637, 148940,
      149244, 149548, 149853, 150157, 150462, 150767, 151072, 151377,
      151683, 151989, 152295, 152601, 152908, 153215, 153522, 153829,
      154137, 154445, 154753, 155061, 155369, 155678, 155987, 156297,
      156606, 156916, 157226, 157536, 157847, 158157, 158468, 158780,
      159091, 159403, 159715, 160027, 160340, 160653, 160966, 161279,
      161593, 161907, 162221, 162535, 162850, 163165, 163480, 163795,
      164111, 164427, 164744, 165060, 165377, 165694, 166012, 166329,
      166647, 166966, 167284, 167603, 167922, 168242, 168561, 168882,
      169202, 169522, 169843, 170165, 170486, 170808, 171130, 171452,
      171775, 172098, 172422, 172745, 173069, 173393, 173718, 174043,
      174368, 174694, 175019, 175346, 175672, 175999, 176326, 176653,
      176981, 177309, 177638, 177966, 178296, 178625, 178955, 179285,
      179615, 179946, 180277, 180609, 180941, 181273, 181605, 181938,
      182271, 182605, 182939, 183273, 183608, 183943, 184278, 184614,
      184950, 185286, 185623, 185960, 186298, 186636, 186974, 187313,
      187652, 187992, 188331, 188672, 189012, 189353, 189695, 190037,
      190379, 190721, 191064, 191408, 191752, 192096, 192440, 192785,
      193131, 193477, 193823, 194170, 194517, 194864, 195212, 195560,
      195909, 196259, 196608, 196958, 197309, 197660, 198011, 198363,
      198715, 199068, 199421, 199775, 200129, 200484, 200839, 201194,
      201550, 201907, 202263, 202621, 202979, 203337, 203696, 204055,
      204415, 204775, 205136, 205497, 205859, 206221, 206584, 206947,
      207311, 207675, 208040, 208405, 208771, 209137, 209504, 209872,
      210240, 210608, 210977, 211347, 211717, 212087, 212459, 212830,
      213203, 213576, 213949, 214323, 214698, 215073, 215448, 215825,
      216202, 216579, 216957, 217336, 217715, 218095, 218475, 218856,
      219238, 219620, 220003, 220387, 220771, 221156, 221541, 221927,
      222314, 222701, 223089, 223478, 223867, 224257, 224648, 225039,
      225431, 225824, 226217, 226611, 227006, 227402, 227798, 228195,
      228592, 228991, 229390, 229789, 230190, 230591, 230993, 231396,
      231799, 232204, 232609, 233014, 233421, 233828, 234236, 234645,
      235055, 235466, 235877, 236289, 236702, 237116, 237530, 237946,
      238362, 238779, 239197, 239616, 240036, 240457, 240878, 241300,
      241724, 242148, 242573, 242999, 243426, 243854, 244283, 244712,
      245143, 245575, 246008, 246441, 246876, 247311, 247748, 248186,
      248624, 249064, 249505, 249946, 250389, 250833, 251278, 251724,
      252171, 252619, 253068, 253519, 253970, 254423, 254877, 255332,
      255788, 256245, 256703, 257163, 257624, 258086, 258549, 259014,
      259480, 259947, 260415, 260885, 261356, 261828, 262302, 262777,
      263253, 263731, 264210, 264690, 265172, 265655, 266140, 266626,
      267113, 267602, 268093, 268585, 269079, 269574, 270070, 270569,
      271068, 271570, 272073, 272578, 273084, 273592, 274102, 274613,
      275127, 275642, 276158, 276677, 277197, 277719, 278243, 278769,
      279297, 279827, 280359, 280892, 281428, 281966, 282505, 283047,
      283591, 284137, 284685, 285236, 285789, 286343, 286901, 287460,
      288022, 288586, 289152, 289721, 290293, 290867, 291443, 292022,
      292604, 293188, 293775, 294365, 294958, 295553, 296151, 296753,
      297357, 297964, 298574, 299187, 299803, 300423, 301046, 301672,
      302301, 302934, 303571, 304211, 304854, 305502, 306153, 306807,
      307466, 308129, 308795, 309466, 310141, 310821, 311504, 312192,
      312885, 313582, 314284, 314991, 315703, 316420, 317142, 317870,
      318603, 319341, 320085, 320835, 321591, 322354, 323122, 323897,
      324678, 325467, 326262, 327064, 327874, 328692, 329517, 330351,
      331193, 332043, 332902, 333771, 334649, 335536, 336434, 337343,
      338262, 339193, 340135, 341090, 342058, 343038, 344033, 345042,
      346066, 347107, 348163, 349238, 350330, 351443, 352575, 353730,
      354907, 356109, 357337, 358593, 359879, 361197, 362550, 363941,
      365373, 366850, 368377, 369959, 371603, 373316, 375109, 376993,
      378985, 381105, 383383, 385858, 388596, 391703, 395388, 400188,
      411774, 411774,
    };
  }
}
